var interactiveMapNew=function(a){var d={},e,h,f;d.positionPins=function(){setTimeout(function(){e=a(".interactive-map-new-container");e.find(".pin").each(function(){var b=358<=a(this).parent().height()?a(this).parent().height():358;a(this).css({top:(b/100*a(this).attr("data-top")-a(this).height())/a(this).attr("data-height")*100+"%",left:a(this).attr("data-left")+"%"})})},500)};d.initPinClick=function(b){h.click(function(c){c.stopPropagation();c=a(this).attr("data-index");d.showDetail(a(this),c);
a(this).hasClass("show")||(c=(a(this).find(".pin-title").width()+a(this).width())/2,a(this).find(".pin-title").css({left:"-"+c+"px"}));c=a(this).data("at-module");atModel.doAtEvent(c+atModel.atSpliter+window.location.href,"action",event);d.initImgPosition(b)})};d.showDetail=function(b,c){var k=a(b).parent().parent().find(".pin-details-inner[data-index\x3d"+c+"]"),g=a(b).parent().parent().find(".pin.show");g=g?g.attr("data-index"):-1;parseInt(g)!==parseInt(c)&&(a(".pin").removeClass("show"),b.addClass("show"),
a(b).parent().parent().find(".pin-details").html(k.html()),f.find(".interactive-map-banner").attr("id","pin-details-"+c),0>=f.find(".interactive-map-banner").children().length&&f.find(".interactive-map-banner").hide(),a(b).parent().parent().find(".pin-details .carousel").carousel(),d.setPosition(b))};d.setPosition=function(b){b.position();b.width();b.height();h.not(b).each(function(){var b=(a(this).parent().height()/100*a(this).attr("data-top")-a(this).height())/a(this).parent().height()*100+"%",
c=a(this).attr("data-left")+"%";a(this).css({top:b,left:c})});if(b.hasClass("show")){b.css({});var c=(b.find(".pin-title").width()+b.width())/2;b.find(".pin-title").css({left:"-"+c+"px"})}};d.initPinsVideoImg=function(){function b(a,b){if(!a)return"";if(-1!==a.indexOf(b+"\x3d")){b=new RegExp("(^|\x26)"+b+"\x3d([^\x26]*)(\x26|$)","i");var c=a.indexOf("?");a=a.slice(c+1,a.length).substr(0).match(b);return null!=a?unescape(a[2]):""}return-1!==a.indexOf("youtu")?(b=a.lastIndexOf("/"),a.slice(b+1,a.length+
1)):""}a.each(e.find(".pin-video"),function(c,d){c=a(d).find(".hik-video-trigger").attr("data-video-path");c=b(c,"v");c=location.protocol+"//img.youtube.com/vi/"+c+"/0.jpg";a(d).find(".video-image-hidden").attr("src",c)})};d.initImgPosition=function(b){var c=.56*b.width(),d=b.find(".map-wrapper").height(),e=b.find(".pin-details").height();d>=e?b.find(".map-wrapper").removeClass("sticky-fixed").removeClass("sticky-bottom").addClass("auto"):a(document).scrollTop()+96>b.offset().top&&a(document).scrollTop()+
96<b.offset().top+b.height()-b.find(".map-wrapper").height()?(b.find(".map-wrapper").width(c),b.find(".map-wrapper").addClass("sticky-fixed").removeClass("sticky-bottom").removeClass("auto")):a(document).scrollTop()+96<b.offset().top?b.find(".map-wrapper").removeClass("sticky-fixed").removeClass("sticky-bottom").addClass("auto"):b.find(".map-wrapper").removeClass("sticky-fixed").addClass("sticky-bottom").removeClass("auto")};d.init=function(){a(document).ready(function(){a.each(a(".interactive-map-new-container"),
function(){h=a(this).find(".pin");a(this).find(".pin-details-inner");f=a(this).find(".pin-details");a(this).find(".carousel-inner").find(".carousel-item");a.each(a(this).find(".carousel-indicators"),function(b,d){1>=a(d).find("li").length&&a(d).hide()});1>=a(this).find(".carousel-inner").find(".carousel-item").length&&a(this).find(".carousel-indicators").hide();var b=a(this).find(".pin[data-index\x3d'0']");e=a(this);d.showDetail(b,0);d.positionPins();d.initPinClick(e);d.initPinsVideoImg();if("DESKTOP"==
getCurrentBreakpoint())a(document).on("scroll resize",function(){d.initImgPosition(e)})})})};return d}($);interactiveMapNew.init();